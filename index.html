<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ç†±é‡åŠ©æ‰‹ Pro</title>
    <style>
        :root { --ios-blue: #007AFF; --ios-green: #34C759; --ios-orange: #FF9500; --ios-red: #FF3B30; --ios-bg: #F2F2F7; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--ios-bg); margin: 0; padding: 15px; color: #1C1C1E; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 15px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h2 { font-size: 17px; margin: 0 0 12px 0; display: flex; justify-content: space-between; align-items: center; font-weight: 700; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        input, select { border: 1.5px solid #E5E5EA; border-radius: 10px; padding: 12px; font-size: 16px; width: 100%; box-sizing: border-box; background: #F9F9F9; }
        input:focus { border-color: var(--ios-blue); outline: none; background: #FFF; }
        button { border: none; border-radius: 12px; padding: 14px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; color: white; active-opacity: 0.7; }
        .summary-row { display: flex; justify-content: space-around; text-align: center; padding: 10px 0; }
        .summary-item b { font-size: 24px; display: block; color: var(--ios-blue); }
        .status-box { text-align: center; padding: 15px; font-size: 50px; }
        .status-text { font-size: 15px; font-weight: 600; text-align: center; margin-bottom: 10px; }
        .log-item { display: flex; justify-content: space-between; padding: 12px 5px; border-bottom: 0.5px solid #EEE; font-size: 15px; }
        .cal-pos { color: var(--ios-red); }
        .cal-neg { color: var(--ios-blue); }
        .user-section { background: linear-gradient(135deg, #007AFF, #0056b3); color: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; }
        .user-section h2 { color: white; }
    </style>
</head>
<body>

    <div class="user-section">
        <h2>ğŸ‘¤ å¸³è™Ÿï¼š<span id="currentUserDisplay">è¨ªå®¢</span></h2>
        <div class="grid" style="grid-template-columns: 2fr 1fr;">
            <input type="text" id="accountInput" placeholder="è¼¸å…¥åç¨±">
            <button style="background: rgba(255,255,255,0.2); border: 1px solid white;" onclick="switchUser()">ç™»å…¥</button>
        </div>
    </div>

    <div class="card">
        <div class="summary-row">
            <div class="summary-item"><small>ç›®æ¨™</small><b id="targetVal">--</b></div>
            <div class="summary-item"><small>æ·¨æ”å–</small><b id="intakeVal">--</b></div>
            <div class="summary-item"><small>å‰©é¤˜</small><b id="remVal">--</b></div>
        </div>
        <div id="statusIcon" class="status-box">ğŸŒ±</div>
        <div id="statusLabel" class="status-text">ä»Šå¤©é‚„æ²’é–‹å§‹ç´€éŒ„å–”ï¼</div>
    </div>

    <div class="card">
        <h2>âš™ï¸ è¨­å®š</h2>
        <div class="grid">
            <input type="number" id="h" placeholder="èº«é«˜ cm">
            <input type="number" id="w" placeholder="é«”é‡ kg">
            <input type="number" id="a" placeholder="å¹´é½¡">
            <input type="time" id="t" title="æé†’æ™‚é–“">
        </div>
        <button style="background: var(--ios-blue);" onclick="saveProfile()">æ›´æ–°æ•¸æ“š</button>
    </div>

    <div class="card" style="border-top: 5px solid var(--ios-green);">
        <h2>ğŸ é£²é£Ÿç´€éŒ„</h2>
        <div class="grid" style="grid-template-columns: 2fr 1fr;">
            <input type="text" id="fname" placeholder="é£Ÿç‰©å…§å®¹">
            <input type="number" id="fcal" placeholder="ç†±é‡">
        </div>
        <button style="background: var(--ios-green);" onclick="addLog('food')">æ–°å¢é£²é£Ÿ</button>
    </div>

    <div class="card" style="border-top: 5px solid var(--ios-orange);">
        <h2>ğŸƒâ€â™‚ï¸ é‹å‹•è¾¨è­˜</h2>
        <div class="grid" style="grid-template-columns: 2fr 1fr;">
            <input type="text" id="exName" placeholder="é‹å‹•(å¦‚:å¿«èµ°)">
            <input type="number" id="exMin" placeholder="åˆ†é˜">
        </div>
        <button style="background: var(--ios-orange);" onclick="addLog('ex')">è¨ˆç®—æ¶ˆè€—</button>
    </div>

    <div class="card">
        <h2>ğŸ“‹ ä»Šæ—¥ç´€éŒ„</h2>
        <div id="logList"></div>
        <button onclick="clearAll()" style="background:#8E8E93; margin-top:20px; font-size:13px;">æ¸…é™¤å¸³è™Ÿæ‰€æœ‰ç´€éŒ„</button>
    </div>

    <script>
        let currentUser = localStorage.getItem('lastUser') || 'Guest';
        let allUsersData = JSON.parse(localStorage.getItem('multiUserData')) || {};

        if (!allUsersData[currentUser]) {
            allUsersData[currentUser] = { h:170, w:60, a:25, t:"21:00", logs: [], tdee: 2000 };
        }
        let db = allUsersData[currentUser];

        window.onload = function() {
            loadUserData();
            setInterval(checkNotif, 60000);
        };

        function switchUser() {
            const newUser = document.getElementById('accountInput').value.trim();
            if (!newUser) return;
            allUsersData[currentUser] = db;
            currentUser = newUser;
            localStorage.setItem('lastUser', currentUser);
            if (!allUsersData[currentUser]) {
                allUsersData[currentUser] = { h:170, w:60, a:25, t:"21:00", logs: [], tdee: 2000 };
            }
            db = allUsersData[currentUser];
            document.getElementById('accountInput').value = '';
            loadUserData();
        }

        function loadUserData() {
            document.getElementById('currentUserDisplay').innerText = currentUser;
            document.getElementById('h').value = db.h || '';
            document.getElementById('w').value = db.w || '';
            document.getElementById('a').value = db.a || '';
            document.getElementById('t').value = db.t || '21:00';
            render();
        }

        function saveProfile() {
            db.h = document.getElementById('h').value;
            db.w = document.getElementById('w').value;
            db.a = document.getElementById('a').value;
            db.t = document.getElementById('t').value;
            db.tdee = Math.round((10 * db.w + 6.25 * db.h - 5 * db.a + 5) * 1.2);
            save();
            alert("è¨­å®šå·²å„²å­˜");
        }

        function addLog(type) {
            let n, c;
            if(type === 'food') {
                n = document.getElementById('fname').value;
                c = parseInt(document.getElementById('fcal').value);
                document.getElementById('fname').value = '';
                document.getElementById('fcal').value = '';
            } else {
                let name = document.getElementById('exName').value;
                let min = parseFloat(document.getElementById('exMin').value);
                if(!name || !min) return;
                let met = 4.0;
                if(name.includes("è·‘")) met = 8.5;
                else if(name.includes("èµ°")) met = 3.5;
                else if(name.includes("ç±ƒ") || name.includes("è¶³")) met = 8.0;
                n = name + "(" + min + "åˆ†)";
                c = -Math.round(met * db.w * (min / 60));
                document.getElementById('exName').value = '';
                document.getElementById('exMin').value = '';
            }
            if(n && !isNaN(c)) {
                db.logs.push({ n, c });
                save();
            }
        }

        function save() {
            allUsersData[currentUser] = db;
            localStorage.setItem('multiUserData', JSON.stringify(allUsersData));
            render();
        }

        function render() {
            const tdee = db.tdee || 2000;
            const intake = db.logs.reduce((s, i) => s + i.c, 0);
            const rem = tdee - intake;
            
            document.getElementById('targetVal').innerText = tdee;
            document.getElementById('intakeVal').innerText = intake;
            document.getElementById('remVal').innerText = rem;

            let icon = "ğŸŒ±", label = "é–‹å§‹ä»Šå¤©çš„å¥åº·ä¹‹æ—…ï¼", color = "#8E8E93";
            if(db.logs.length > 0) {
                if(rem >= 300) { icon = "ğŸŒ³"; label = "å¤ªæ£’äº†ï¼ä½ çš„æ£®æ—éå¸¸èŒ‚ç››ï¼"; color = "var(--ios-green)"; }
                else if(rem >= 0) { icon = "ğŸ"; label = "æˆåŠŸé”æ¨™ï¼æœå¯¦çµå¾—å¾ˆå¥½ï¼"; color = "var(--ios-orange)"; }
                else { icon = "ğŸ’€"; label = "ç†±é‡è¶…æ¨™ï¼æ˜å¤©å†åŠ æ²¹ï¼"; color = "var(--ios-red)"; }
            }
            document.getElementById('statusIcon').innerText = icon;
            document.getElementById('statusLabel').innerText = label;
            document.getElementById('statusLabel').style.color = color;

            document.getElementById('logList').innerHTML = db.logs.map(i => `
                <div class="log-item"><span>${i.n}</span><b class="${i.c > 0 ? 'cal-pos' : 'cal-neg'}">${i.c > 0 ? '+' : ''}${i.c}</b></div>
            `).reverse().join('');
        }

        function checkNotif() {
            const cur = new Date().getHours().toString().padStart(2, '0') + ":" + new Date().getMinutes().toString().padStart(2, '0');
            if(cur === db.t && db.logs.length === 0) alert("â° å—¨ " + currentUser + "ï¼Œè¨˜å¾—ç´€éŒ„ä»Šå¤©çš„ç†±é‡å–”ï¼");
        }

        function clearAll() { if(confirm("ç¢ºå®šæ¸…é™¤ç´€éŒ„ï¼Ÿ")) { db.logs = []; save(); } }
    </script>
</body>
</html>